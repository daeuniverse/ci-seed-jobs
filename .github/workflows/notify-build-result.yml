---
name: Notify build result

on:
  workflow_call:
    # Map input secrets to job
    secrets:
      TELEGRAM_TO:
        required: true
      TELEGRAM_TOKEN:
        required: true
    # Map input vars to job
    inputs:
      IMAGE_NAME:
        required: true
        type: string
      IMAGE_TAG:
        required: true
        type: string
      SHA_SHORT:
        required: true
        type: string

jobs:
  # Post-Action Stage
  notify-build-result:
    runs-on: ubuntu-latest
    steps:
      - name: Send telegram message to notify build result
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_TO }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          format: markdown
          message: |
            üèó ${{ github.repository }}(${{ inputs.SHA_SHORT }}): Build #${{ github.run_number }} succeeded!

            üì¶ Image URI: quay.io/${{ github.repository_owner }}/${{ inputs.IMAGE_NAME }}:${{ inputs.IMAGE_TAG }}

            üî® Build Detail: [#${{ github.run_number }}](https://github.com/daeuniverse/container-estate/actions/runs/${{ github.run_id }})
